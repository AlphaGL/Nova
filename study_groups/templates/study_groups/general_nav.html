{% load static %}

<header class="header header--loggedIn bg-blue">
  <div class="container d-flex justify-content-between align-items-center py-1 px-2 ultra-slim-header">
    <a href="{% url 'study_group_home' %}" class="header__logo d-flex align-items-center text-white text-decoration-none">
      <img src="{% static 'assets/study_groups/logo.svg' %}" class="me-2" height="24" />
      <h1 class="m-0 fs-6">{% block header %}Study Groups{% endblock %}</h1>
    </a>

    <nav class="header__menu d-flex align-items-center">
      {% if user.is_authenticated %}
      <div class="header__user d-flex align-items-center text-white position-relative">
        <img src="{{ user.avatar.url }}" class="rounded-circle me-2" height="28" width="28" />
        <div class="me-2">
          <p class="m-0 fw-semibold small" style="line-height: 1;">{{ user.name }}</p>
          <a href="{% url 'update_user' %}" class="text-white-50 text-decoration-none small">@{{ user.username }}</a>
        </div>
        <button class="dropdown-button bg-transparent border-0 text-white ms-2" onclick="toggleDropdown()" aria-label="Menu">‚ãÆ</button>
      </div>
      {% else %}
      <a href="{% url 'login' %}" class="d-flex align-items-center text-white text-decoration-none">
        <img src="{% static 'assets/study_groups/avatar.svg' %}" height="24" class="me-1" />
        <p class="m-0 small">Login</p>
      </a>
      {% endif %}

      <!-- Dropdown -->
      <div id="dropdownMenu" class="dropdown-menu-custom">
        <a href="{% url 'update_user' %}" class="dropdown-link">‚öôÔ∏è Settings</a>
        <a href="{% url 'logout' %}" class="dropdown-link">üö™ Logout</a>
      </div>
    </nav>
  </div>
</header>

<style>
  .bg-blue {
    background-color: #0056b3;
    color: white;
  }

  .ultra-slim-header {
    max-height: 50px;
  }

  .header__logo img {
    height: 24px;
  }

  .dropdown-button {
    font-size: 1.15rem;
    cursor: pointer;
    padding: 0;
    line-height: 1;
  }

  .dropdown-menu-custom {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 6px;
    background: white;
    color: #333;
    border-radius: 6px;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    display: none;
    flex-direction: column;
    z-index: 1000;
    min-width: 140px;
    font-size: 0.85rem;
  }

  .dropdown-menu-custom.show {
    display: flex;
  }

  .dropdown-link {
    padding: 8px 12px;
    text-decoration: none;
    color: #0056b3;
    border-bottom: 1px solid #eee;
    transition: background 0.25s;
  }

  .dropdown-link:hover {
    background: #e6f2ff;
  }

  .rounded-circle {
    object-fit: cover;
  }
</style>

<script>
  function toggleDropdown() {
    const menu = document.getElementById('dropdownMenu');
    menu.classList.toggle('show');
  }

  document.addEventListener("click", function(event) {
    const menu = document.getElementById('dropdownMenu');
    const button = document.querySelector('.dropdown-button');
    if (!menu.contains(event.target) && !button.contains(event.target)) {
      menu.classList.remove('show');
    }
  });
</script>
