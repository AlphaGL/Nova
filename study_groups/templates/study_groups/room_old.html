{% extends 'study_groups/base.html' %}
{% load static %}
{% block content %}
<style>
    .room-container {
        display: grid;
        grid-template-columns: 3fr 1fr;
    }
</style>

<div class="room-container">
    <div class="room-main">
        <!-- Room Name and Description -->
        <section class="room-header">
            <h1>{{ room.name }}</h1>
            <p>{{ room.description }}</p>
        </section>

        <!-- Conversation Section -->
        <div class="comment-wrapper">
            <h3>Conversation</h3>
            <hr />

            {% if room_messages %}
                {% for message in room_messages %}
                    <div class="message-block">
                        <div class="message-header">
                            <small>
                                @{{ message.user }} â€¢ {{ message.created|timesince }} ago
                            </small>
                            {% if user == message.user %}
                                <a href="{% url 'delete_message' message.id %}" class="delete-link">Delete</a>
                            {% endif %}
                        </div>

                        <p>{{ message.body }}</p>

                        {% if message.media %}
                            <div class="media-preview">
                                {% with message.media.url|lower as media_url %}
                                    {% if media_url|slice:"-4:" == ".jpg" or media_url|slice:"-5:" == ".jpeg" or media_url|slice:"-4:" == ".png" or media_url|slice:"-4:" == ".gif" %}
                                        <img src="{{ message.media.url }}" alt="Image"
                                             style="max-width: 300px; max-height: 300px;">
                                    {% elif media_url|slice:"-4:" == ".mp4" or media_url|slice:"-5:" == ".webm" or media_url|slice:"-4:" == ".ogg" %}
                                        <video controls style="max-width: 300px; max-height: 300px;">
                                            <source src="{{ message.media.url }}">
                                            Your browser does not support the video tag.
                                        </video>
                                    {% else %}
                                        <a href="{{ message.media.url }}">{{ message.media.name }}</a>
                                    {% endif %}
                                {% endwith %}
                            </div>
                        {% endif %}
                        <hr />
                    </div>
                {% endfor %}
            {% else %}
                <p>No messages yet. Be the first to start the conversation!</p>
            {% endif %}

            <!-- Message Form -->
            {% if user.is_authenticated %}
                <div class="comment-form">
                    <form action="" method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        <input type="text" name="body" placeholder="Write your message here..." required />
                        <input type="file" name="media" accept="image/*,video/*" />
                        <button type="submit">Send</button>
                    </form>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Participants Section -->
    <aside class="participants-section">
        <h3>Participants</h3>
        {% for user in participants %}
            <div>
                <p>@{{ user.username }}</p>
            </div>
        {% empty %}
            <p>No participants yet.</p>
        {% endfor %}
    </aside>
</div>



{% endblock %}
